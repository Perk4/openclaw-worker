# 2026-02-07 Session Notes — Satin Shield Higgsfield Migration

## Summary
Migrated Satin Shield avatar generation from Hedra (broken multi-ref API) to Higgsfield Speak v2. Built MVP Avatar UI with model info display and script validation.

---

## Higgsfield API Details

### Speak v2 Endpoint (Verified Working ✅)
```
POST https://platform.higgsfield.ai/v1/speak/higgsfield
Authorization: Key {KEY_ID}:{KEY_SECRET}
User-Agent: higgsfield-server-js/2.0

{
  "params": {
    "input_image": { "type": "image_url", "image_url": "..." },
    "input_audio": { "type": "audio_url", "audio_url": "..." },  // WAV only!
    "prompt": "speaking naturally with warm expression"
  }
}
```

### Status Polling (IMPORTANT)
```
GET https://platform.higgsfield.ai/requests/{request_id}/status
```
**Note:** No `/v1/` prefix! Returns `{ status, video: { url } }`

### SoulId (Custom References)
```
POST /v1/custom-references          — Create SoulId (1+ images)
GET  /v1/custom-references/list     — List existing SoulIds
```
**Limitation:** SoulId only works with Text2Image/Soul, NOT directly with Speak v2.

### Model Limits
| Component | Provider | Model | Limit |
|-----------|----------|-------|-------|
| Video Gen | Higgsfield | Speak v2 | **5, 10, or 15 seconds** |
| TTS | OpenAI | TTS-1 | **4096 characters** (~800 words) |

Speech rate: ~2.5 words/sec → 15 sec video ≈ 37 words max

---

## Worker Endpoints Created

```
POST /api/higgsfield/speak              — Generate talking head video
GET  /api/higgsfield/speak/:jobId       — Get job status
GET  /api/higgsfield/jobs               — List all jobs
POST /api/higgsfield/resume/:jobId      — Resume failed job
GET  /api/higgsfield/status/:requestId  — Check Higgsfield status directly
GET  /api/higgsfield/soulids            — List custom references
POST /api/higgsfield/soulid/test-create — Test SoulId creation
GET  /api/higgsfield/test               — Test API connection
POST /api/higgsfield/test-speak         — Debug Speak v2 call
```

---

## UI Changes (MVP Avatar Studio)

### Features Implemented
- Single portrait image upload (replaced multi-ref slots)
- Script source toggle: "Write New" / "From Library"
- "Copy & Edit" button to edit library scripts without changing original
- Voice selector (6 OpenAI voices)
- Expression presets (Friendly, Professional, Excited, Calm, Educational, Custom)
- Model info banner showing Higgsfield + OpenAI limits
- Real-time script validation (word count, duration, warnings)
- Credit estimate display (~25 credits)

### Commits
- `901c85b` — MVP Avatar Studio
- `5a6fc5d` — UX fixes (image remove button, copy & edit)
- `3b2c9b8` — Model info banner + script validation

---

## Credits Used
- Started: 800
- Used: ~40 (2 test video generations)
- Remaining: ~760

---

## Product Roadmap Created

See `/root/clawd/satin-shield/demo/PRODUCT-ROADMAP.md`

### Phases
1. **MVP (Complete ✅)** — Simple Speak v2 integration
2. **Characters** — SoulId for consistent brand characters
3. **Multi-Ref** — Character + Product + Environment
4. **Video Composer** — Remotion + beat sheets for multi-scene

### Beat Sheet Pipeline (Phase 4)
```
Full Script (60s)
      ↓
Beat Sheet Splitter
      ↓
Scenes (max 15s each)
      ↓
TTS per scene → Higgsfield per scene
      ↓
Remotion Compositor → Final video
```

---

## Key Files
- Worker: `/root/clawd/satin-shield/demo/worker/index.ts`
- UI: `/root/clawd/satin-shield/ui/src/App.tsx`
- Roadmap: `/root/clawd/satin-shield/demo/PRODUCT-ROADMAP.md`
- TODO: `/root/clawd/satin-shield/demo/TODO-HIGGSFIELD-MIGRATION.md`
- UI Plan: `/root/clawd/satin-shield/demo/UI-MIGRATION-PLAN.md`

---

## Git
- Repo: `https://github.com/Perk4/satin-shield.git`
- Branch: `deploy`
- Latest commit: `3b2c9b8`
